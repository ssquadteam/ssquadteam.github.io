<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Game</title>
<style>
  body { margin: 0; overflow: hidden; }
  canvas { background: #cceeff; display: block; }
  .score { position: absolute; color: #000; top: 10px; left: 10px; font-size: 24px; }
  .highScore { position: absolute; color: #000; top: 10px; right: 10px; font-size: 24px; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div class="score" id="score">Score: 0</div>
<div class="highScore" id="highScore">High Score: 0</div>
<script>
  var canvas = document.getElementById('gameCanvas');
  var ctx = canvas.getContext('2d');
  // Set canvas to be full screen and portrait
  canvas.width = window.innerWidth > window.innerHeight ? window.innerHeight / 2 : window.innerWidth;
  canvas.height = window.innerHeight;

  var bird = { x: 50, y: canvas.height / 2, width: 30, height: 25, gravity: 0.6, lift: -15, velocity: 0, symbol: '🐦' };
  var poles = [];
  var score = 0;
  var highScore = localStorage.getItem('highScore') || 0;
  var gap = 150; // Adjusted for portrait
  var poleWidth = 50;
  var interval = 2000; // Interval in milliseconds to add new poles
  var firstPoleOffset = 500; // Offset for the first pole to appear closer
  var lastTime = Date.now() - firstPoleOffset; // Adjust for the first pole to appear sooner
  var gameSpeed = 2;

  // Update the high score text
  document.getElementById('highScore').innerText = 'High Score: ' + highScore;

  function drawBird() {
    ctx.font = bird.width + 'px Arial';
    ctx.fillText(bird.symbol, bird.x, bird.y);
  }

  function updateBird() {
    bird.velocity += bird.gravity;
    bird.velocity *= 0.9;
    bird.y += bird.velocity;

    if (bird.y > canvas.height) {
      bird.y = canvas.height - bird.height;
      bird.velocity = 0;
    }

    if (bird.y < 0) {
      bird.y = 0;
      bird.velocity = 0;
    }
  }

  function handlePoles() {
    if (Date.now() - lastTime > interval) {
      var poleHeight = Math.floor(Math.random() * (canvas.height - gap));
      poles.push({ x: canvas.width, y: 0, width: poleWidth, height: poleHeight });
      poles.push({ x: canvas.width, y: poleHeight + gap, width: poleWidth, height: canvas.height - poleHeight - gap });
      lastTime = Date.now();
    }

    for (var i = poles.length - 1; i >= 0; i--) {
      poles[i].x -= gameSpeed;
      ctx.fillStyle = 'green';
      ctx.fillRect(poles[i].x, poles[i].y, poles[i].width, poles[i].height);

      // Check if the pole has just passed the bird to increment score
      if (poles[i].x + poleWidth < bird.x && !poles[i].scored) {
        poles[i].scored = true; // Mark pole as scored
        score++;
        document.getElementById('score').innerText = 'Score: ' + score;
        if (score > highScore) {
          highScore = score;
          localStorage.setItem('highScore', highScore);
          document.getElementById('highScore').innerText = 'High Score: ' + highScore;
        }
      }
    }
  }

  function detectCollision() {
    for (var i = 0; i < poles.length; i++) {
      if (bird.x < poles[i].x + poles[i].width &&
          bird.x + bird.width > poles[i].x &&
          bird.y < poles[i].y + poles[i].height &&
          bird.y + bird.height > poles[i].y) {
        // Collision detected, reset score and bird position
        score = 0;
        bird.y = canvas.height / 2;
        bird.velocity = 0;
        poles = [];
        document.getElementById('score').innerText = 'Score: ' + score;
      }
    }
  }

  function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    handlePoles();
    updateBird();
    drawBird();
    detectCollision();
    requestAnimationFrame(loop);
  }

  function flap() {
    bird.velocity += bird.lift;
  }

  document.addEventListener('keydown', function(e) {
    if (e.code === 'Space') {
      flap();
    }
  });

  canvas.addEventListener('touchstart', function(e) {
    flap();
    e.preventDefault();
  }, { passive: false });

  loop();
</script>
</body>
</html>
