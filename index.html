<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Game</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    background: #f3f3f3;
  }
  #gameCanvas {
    display: block;
    background: #fff;
    border: 1px solid #000;
  }
  .score {
    position: absolute;
    color: #000;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<div class="score" id="score">Score: 0</div>
<script>
  var canvas = document.getElementById('gameCanvas');
  var ctx = canvas.getContext('2d');
  var bird = { x: 50, y: canvas.height / 2, width: 30, height: 25, gravity: 0.6, lift: -15, velocity: 0, symbol: '🐦' };
  var poles = [];
  var score = 0;
  var highScore = localStorage.getItem('highScore') || 0;
  var gap = 150;
  var poleWidth = 50;
  var gameSpeed = 2;
  var lastTime = Date.now();
  var interval = 2000;
  var firstPoleOffset = 500;

  function drawBird() {
    ctx.fillStyle = 'yellow';
    ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
  }

  function updateBird() {
    bird.velocity += bird.gravity;
    bird.velocity *= 0.9;
    bird.y += bird.velocity;

    if (bird.y > canvas.height - bird.height) {
      bird.y = canvas.height - bird.height;
      bird.velocity = 0;
    }

    if (bird.y < 0) {
      bird.y = 0;
      bird.velocity = 0;
    }
  }

  function handlePoles() {
    if (Date.now() - lastTime > interval) {
      var poleHeight = Math.floor(Math.random() * (canvas.height - gap));
      poles.push({ x: canvas.width, y: 0, width: poleWidth, height: poleHeight, scored: false });
      poles.push({ x: canvas.width, y: poleHeight + gap, width: poleWidth, height: canvas.height - poleHeight - gap, scored: false });
      lastTime = Date.now();
    }

    for (var i = poles.length - 1; i >= 0; i--) {
      poles[i].x -= gameSpeed;
      ctx.fillStyle = 'green';
      ctx.fillRect(poles[i].x, poles[i].y, poles[i].width, poles[i].height);

      if (poles[i].x + poleWidth < bird.x && !poles[i].scored) {
        poles[i].scored = true;
        score++;
        document.getElementById('score').innerText = 'Score: ' + score;
        if (score > highScore) {
          highScore = score;
          localStorage.setItem('highScore', highScore);
        }
      }

      if (poles[i].x < -poleWidth) {
        poles.splice(i, 1);
      }
    }
  }

  function detectCollision() {
    for (var i = 0; i < poles.length; i++) {
      if (bird.x < poles[i].x + poles[i].width &&
          bird.x + bird.width > poles[i].x &&
          bird.y < poles[i].y + poles[i].height &&
          bird.y + bird.height > poles[i].y) {
        score = 0;
        bird.y = canvas.height / 2;
        bird.velocity = 0;
        poles = [];
        document.getElementById('score').innerText = 'Score: ' + score;
        break;
      }
    }
  }

  function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    handlePoles();
    updateBird();
    drawBird();
    detectCollision();
    requestAnimationFrame(loop);
  }

  function flap() {
    bird.velocity += bird.lift;
  }

  document.addEventListener('keydown', function(e) {
    if (e.code === 'Space') {
      flap();
    }
  });

  canvas.addEventListener('touchstart', function(e) {
    flap();
    e.preventDefault();
  }, { passive: false });

  loop();
</script>
</body>
</html>
